"use strict";var app=angular.module("meerkatApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase","ui.bootstrap"]).constant("FIREBASE_URL","https://meerkat.firebaseio.com/").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/caselog.html",controller:"CaseLogCtrl"}).when("/caselog/",{templateUrl:"views/caselog.html",controller:"CaseLogCtrl"}).otherwise({redirectTo:"/"})}]);app.directive("datepickerPopup",["datepickerPopupConfig","dateParser","dateFilter",function(a,b,c){return{restrict:"A",require:"^ngModel",link:function(b,d,e,f){var g;e.$observe("datepickerPopup",function(b){g=b||a.datepickerPopup,f.$render()}),f.$formatters.push(function(a){return f.$isEmpty(a)?a:c(a,g)})}}}]),app.controller("NavCtrl",["$scope","$location","Post","Auth",function(a,b,c,d){a.signedIn=d.signedIn,a.logout=d.logout,a.user=d.user,a.post={url:"http://",title:""},a.submitPost=function(){a.post.creator=a.user.profile.username,a.post.creatorUID=a.user.uid,c.create(a.post).then(function(c){b.path("/posts/"+c.name()),a.post={url:"http://",title:""}})}}]),app.controller("CaseLogCtrl",["$scope","Cases","Students",function(a,b,c){a.newUser=!1,a.login=function(){console.log("in login!"),null!==c.checkIfUserExists(a.selectedStudent)?console.log("NetID exists!"):(console.log("No such user! Creating..."),a.newUser=!0)},a.cases=b.all,a["case"]={studentName:"",date:"",patientId:"",patientName:"",patientSurname:"",patientSpecies:"",caseType:"",surgeryProcedure:"",diagnoses:["","",""],treatment:"",outcome:"",followup:"",clinicians:[]},a.selectedStudent=void 0,a.newStudentFlag=!0,a.snames=c.all,a.submitCase=function(){for(var d=a["case"].diagnoses.length-1;d>=0;d--)(null===a["case"].diagnoses[d]||""===a["case"].diagnoses[d])&&a["case"].diagnoses.splice(d,1);if(a.newStudentFlag){var e={studentName:a.selectedStudent};c.create(e).then(function(a){var b=a.name();console.log("Created student: "+b)}),a["case"].studentName=e.studentName}else a["case"].studentName=a.selectedStudent;a["case"].date=a.dt.getTime(),b.create(a["case"]).then(function(){a["case"]={date:"",patientId:"",patientName:"",patientSurname:"",patientSpecies:"",caseType:"",surgeryProcedure:"",diagnoses:["","",""],treatment:"",outcome:"",followup:"",clinicians:[]},a.newStudentFlag=!0,a.selectedStudent=""})},a.deleteCase=function(a){b["delete"](a)},a.debug=function(){for(var b=0;b<a.snames.length;b++)console.log(a.snames[b]);console.log(a.snames)},a.existingStudentSelected=function(){a.newStudentFlag=!1},a.today=function(){a.dt=new Date},a.today(),a.open=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0},a.dateOptions={formatYear:"yy",startingDay:1,"show-weeks":!1},a.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate","MMMM dd, yyyy"],a.format=a.formats[4]}]),app.filter("diagnoses",function(){return function(a){for(var b=[],c=0;c<a.length;c++)b[c]=a[c].value;return b.join(", ")}}),app.factory("Cases",["$firebase","FIREBASE_URL",function(a,b){var c=new Firebase(b),d=a(c.child("studentcases")).$asArray(),e={all:d,create:function(a){return d.$add(a)},get:function(b){return a(c.child("studentcases").child(b)).$asObject()},"delete":function(a){return d.$remove(a)}};return e}]),app.factory("Students",["$firebase","FIREBASE_URL",function(a,b){var c=new Firebase(b+"/students"),d=a(c).$asArray(),e={all:d,create:function(b,d){var e=c.child(b),f=a(e);return f.$set(d),!0},get:function(b){return a(c.child(b)).$asObject()},"delete":function(a){return d.$remove(a)},names:function(){for(var a=[],b=0;b<d.length;b++)a.push(d[b].studentName),console.log("hi");return a},checkIfUserExists:function(a){return console.log("Checking if "+a+" exists..."),console.log(d.$getRecord(a)),d.$getRecord(a)}};return e}]);